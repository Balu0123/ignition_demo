[
  {
    "name": "Packml",
    "typeId": null,
    "tagType": "UdtType",
    "tags": [
      {
        "valueSource": "opc",
        "name": "00-STOPPED",
        "tooltip": "Not Powered On",
        "tagType": "AtomicTag",
        "enabled": true,
        "opcServer": ""
      },
      {
        "valueSource": "opc",
        "name": "01-IDLE",
        "tooltip": "Ready, waiting to start",
        "tagType": "AtomicTag"
      },
      {
        "valueSource": "opc",
        "name": "02-STARTING",
        "tooltip": "Initializing",
        "tagType": "AtomicTag"
      },
      {
        "valueSource": "opc",
        "name": "03-EXECUTE",
        "tooltip": "Running",
        "tagType": "AtomicTag"
      },
      {
        "valueSource": "opc",
        "name": "04-COMPLETING",
        "tooltip": "Finishing the current cycle",
        "tagType": "AtomicTag"
      },
      {
        "valueSource": "opc",
        "name": "05-COMPLETE",
        "tooltip": "cycle complete",
        "tagType": "AtomicTag"
      },
      {
        "valueSource": "opc",
        "name": "06-STOPPING",
        "tooltip": "Controlled Stop",
        "tagType": "AtomicTag"
      },
      {
        "valueSource": "opc",
        "name": "07-ABORTING",
        "tooltip": "Emergency Stop in Progress",
        "tagType": "AtomicTag"
      },
      {
        "valueSource": "opc",
        "name": "08-ABORTED",
        "tooltip": "Fault / E-stop Active",
        "tagType": "AtomicTag"
      },
      {
        "valueSource": "opc",
        "name": "09-HOLDING",
        "tooltip": "Pausing execution",
        "tagType": "AtomicTag"
      },
      {
        "valueSource": "opc",
        "name": "10-HELD",
        "tooltip": "Paused / Operator stopped",
        "tagType": "AtomicTag"
      },
      {
        "valueSource": "opc",
        "name": "11-SUSPENDING",
        "tooltip": "Starvation/blockage in progress",
        "tagType": "AtomicTag"
      },
      {
        "valueSource": "opc",
        "name": "12-SUSPENDED",
        "tooltip": "Starved / blocked",
        "tagType": "AtomicTag"
      },
      {
        "valueSource": "opc",
        "name": "13-UNHOLDING",
        "tooltip": "Resuming from hold",
        "tagType": "AtomicTag"
      },
      {
        "valueSource": "opc",
        "name": "14-UNSUSPENDING",
        "tooltip": "Resuming from suspension",
        "tagType": "AtomicTag"
      },
      {
        "valueSource": "opc",
        "name": "15-RESETTING",
        "tooltip": "Clearing fault / reset",
        "tagType": "AtomicTag"
      },
      {
        "valueSource": "opc",
        "name": "16-CLEARING",
        "tooltip": "Recovering to IDLE",
        "tagType": "AtomicTag"
      }
    ]
  },
  {
    "name": "Unified_State",
    "typeId": null,
    "tagType": "UdtType",
    "tags": [
      {
        "valueSource": "expr",
        "eventScripts": [
          {
            "eventid": "valueChanged",
            "script": "\tif not initialChange and currentValue.value !\u003d previousValue.value:\n\t\tbasePath \u003d \"[.]\"\n    \n    \t# Write previous state\n    \tsystem.tag.writeBlocking(\n       \t[basePath + \"01-PreviousState\"],\n        \t[previousValue.value]\n    \t\t)\n    \n    \t# Write state change time\n    \tsystem.tag.writeBlocking(\n       \t[basePath + \"03-StateChangeTime\"],\n        \t[system.date.now()]\n    \t\t)"
          }
        ],
        "expression": "if(\r\n  //* ---------- FAULT ---------- */\r\n  (\r\n    (tag({[.]Path} + \"/07-ABORTING\")\u003e\u003d1)\r\n    ||\r\n    (tag({[.]Path} + \"/08-ABORTED\")\u003e\u003d1)\r\n  ),\r\n  4,\r\n\r\nif(\r\n  //* ---------- SETUP ---------- */\r\n  (\r\n    (tag({[.]Path} + \"/15-RESETTING\")\u003e\u003d1)\r\n    ||\r\n    (tag({[.]Path} + \"/16-CLEARING\")\u003e\u003d1)\r\n  ),\r\n  5,\r\n\r\nif(\r\n  //* ---------- RUNNING ---------- */\r\n  (\r\n    (tag({[.]Path} + \"/03-EXECUTE\")\u003e\u003d1)\r\n    ||\r\n    (tag({[.]Path} + \"/04-COMPLETING\")\u003e\u003d1)\r\n  ),\r\n  2,\r\n\r\nif(\r\n  //* ---------- IDLE ---------- */\r\n  (\r\n    (tag({[.]Path} + \"/01-IDLE\")\u003e\u003d1)\r\n    ||\r\n    (tag({[.]Path} + \"/05-COMPLETE\")\u003e\u003d1)\r\n  ),\r\n  1,\r\n\r\nif(\r\n  //* ---------- STOPPED ---------- */\r\n  (\r\n    (tag({[.]Path} + \"/09-HOLDING\")\u003e\u003d1)\r\n    ||\r\n    (tag({[.]Path} + \"/10-HELD\")\u003e\u003d1)\r\n    ||\r\n    (tag({[.]Path} + \"/11-SUSPENDING\")\u003e\u003d1)\r\n    ||\r\n    (tag({[.]Path} + \"/12-SUSPENDED\")\u003e\u003d1)\r\n  ),\r\n  3,\r\n\r\nif(\r\n  //* ---------- TRANSITION ---------- */\r\n  (\r\n    (tag({[.]Path} + \"/02-STARTING\")\u003e\u003d1)\r\n    ||\r\n    (tag({[.]Path} + \"/06-STOPPING\")\u003e\u003d1)\r\n    ||\r\n    (tag({[.]Path} + \"/13-UNHOLDING\")\u003e\u003d1)\r\n    ||\r\n    (tag({[.]Path} + \"/14-UNSUSPENDING\")\u003e\u003d1)\r\n  ),\r\n  7,\r\n\r\nif(\r\n  //* ---------- OFF ---------- */\r\n  (tag({[.]Path} + \"/00-STOPPED\")\u003e\u003d1),\r\n  0,\r\n\r\n-1\r\n)))))))\r\n",
        "name": "00-CurrentState",
        "tagType": "AtomicTag"
      },
      {
        "valueSource": "memory",
        "name": "01-PreviousState",
        "tagType": "AtomicTag"
      },
      {
        "valueSource": "expr",
        "expression": "switch(\r\n\t{[.]00-CurrentState},\r\n  \t0,1,2,3,4,5,6,7, \r\n  \t\"OFF\",\"IDLE\",\"RUNNING\",\"STOPPED\",\"FAULT\",\"SETUP\",\"MAINTENANCE\",\"TRANSITION\",\r\n  \t\"UNKNOWN\"\r\n)",
        "dataType": "String",
        "sourceTagPath": "lookup(     [.]00-CurrentState,     0, \"OFF\",     1, \"IDLE\",     2, \"RUNNING\",     3, \"STOPPED\",     4, \"FAULT\",     5, \"SETUP\",     6, \"MAINTENANCE\",     7, \"TRANSITION\",     \"UNKNOWN\" ) ",
        "name": "02-StateName",
        "tagType": "AtomicTag"
      },
      {
        "valueSource": "memory",
        "dataType": "DateTime",
        "name": "03-StateChangeTime",
        "formatString": "yyyy-MM-dd h:mm:ss aa",
        "tagType": "AtomicTag"
      },
      {
        "valueSource": "memory",
        "dataType": "String",
        "name": "Path",
        "tagType": "AtomicTag"
      }
    ]
  },
  {
    "name": "ISA-95",
    "typeId": null,
    "tagType": "UdtType",
    "tags": [
      {
        "valueSource": "expr",
        "eventScripts": [
          {
            "eventid": "valueChanged",
            "script": "\tif not initialChange and currentValue.value !\u003d previousValue.value:\n\t\tbasePath \u003d \"[.]\"\n    \n    \t# Write previous state\n    \tsystem.tag.writeBlocking(\n       \t[basePath + \"01-PreviousState\"],\n        \t[previousValue.value]\n    \t\t)\n    \n    \t# Write state change time\n    \tsystem.tag.writeBlocking(\n       \t[basePath + \"03-StateChangeTime\"],\n        \t[system.date.now()]\n    \t\t)"
          }
        ],
        "expression": "switch(\r\n    tag({[.]Path} + \"/00-CurrentState\"),\r\n\r\n    0, 1, 2, 3, 4, 5, 6, 7,\r\n    0, 1, 2, 3, 3, 4, 4, 4,\r\n    \r\n        -1      // default\r\n    )\r\n    \r\n    // OFF → OFF\r\n    // IDLE → IDLE\r\n    // RUNNING → RUNNING\r\n    // STOPPED → UNSCHEDULED\r\n    // FAULT → UNSCHEDULED\r\n    // SETUP → SCHEDULED\r\n    // MAINTENANCE → SCHEDULED\r\n    // TRANSITION → SCHEDULED\r\n",
        "name": "00-CurrentState",
        "tagType": "AtomicTag"
      },
      {
        "valueSource": "memory",
        "name": "01-PreviousState",
        "tagType": "AtomicTag"
      },
      {
        "valueSource": "expr",
        "expression": "switch(\r\n\t{[.]00-CurrentState},\r\n  \t0,1,2,3,4,\r\n  \t\"OFF\",\"IDLE\",\"RUNNING\",\"UNSCHEDULED STOP\",\"SCHEDULED STOP\",\r\n  \t\"UNKNOWN\"\r\n)",
        "dataType": "String",
        "sourceTagPath": "lookup(     [.]00-CurrentState,     0, \"OFF\",     1, \"IDLE\",     2, \"RUNNING\",     3, \"STOPPED\",     4, \"FAULT\",     5, \"SETUP\",     6, \"MAINTENANCE\",     7, \"TRANSITION\",     \"UNKNOWN\" ) ",
        "name": "02-StateName",
        "tagType": "AtomicTag"
      },
      {
        "valueSource": "memory",
        "dataType": "DateTime",
        "name": "03-StateChangeTime",
        "formatString": "yyyy-MM-dd h:mm:ss aa",
        "tagType": "AtomicTag"
      },
      {
        "valueSource": "memory",
        "dataType": "String",
        "name": "Path",
        "tagType": "AtomicTag"
      }
    ]
  }
]